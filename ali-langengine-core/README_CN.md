# Ali-LangEngine-Core

## é¡¹ç›®ç®€ä»‹

Ali-LangEngine-Core æ˜¯ Agentic-ADK æ¡†æ¶çš„æ ¸å¿ƒå¼•æ“æ¨¡å—ï¼Œæä¾›äº†æ„å»º AI Agent åº”ç”¨æ‰€éœ€çš„åŸºç¡€ç»„ä»¶å’ŒæŠ½è±¡å±‚ã€‚è¯¥æ¨¡å—å®ç°äº†åŸºäº Google ADK æ¥å£çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œé›†æˆäº†å¤šç§å¤§è¯­è¨€æ¨¡å‹ã€å·¥å…·ç³»ç»Ÿã€å†…å­˜ç®¡ç†ã€å‘é‡å­˜å‚¨ç­‰æ ¸å¿ƒèƒ½åŠ›ï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§ã€çµæ´»ä¸”å¯æ‰©å±•çš„ Agent å¼€å‘æ¡†æ¶ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸ¤– å¤šæ™ºèƒ½ä½“æ”¯æŒ
- **Agent åŸºç¡€æ¡†æ¶**ï¼šæä¾›å®Œæ•´çš„ Agent ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **å¤šç§ Agent ç±»å‹**ï¼šæ”¯æŒ AutoGPTã€MRKLã€Plan-Executeã€ReAct ç­‰å¤šç§ Agent æ¨¡å¼
- **Agent æ‰§è¡Œå™¨**ï¼šç»Ÿä¸€çš„ Agent æ‰§è¡Œå’Œè°ƒåº¦å¼•æ“
- **æ™ºèƒ½å·¥å…·è°ƒç”¨**ï¼šè‡ªåŠ¨å·¥å…·é€‰æ‹©å’Œæ‰§è¡Œç®¡ç†

### ğŸ”— é“¾å¼å¤„ç†æ¶æ„
- **LLM é“¾**ï¼šåŸºç¡€çš„è¯­è¨€æ¨¡å‹è°ƒç”¨é“¾
- **é¡ºåºé“¾**ï¼šæ”¯æŒå¤šæ­¥éª¤é“¾å¼å¤„ç†
- **æ¡ä»¶åˆ†æ”¯**ï¼šæ™ºèƒ½è·¯ç”±å’Œæ¡ä»¶åˆ¤æ–­
- **ç»„åˆé“¾**ï¼šå¤æ‚ä¸šåŠ¡é€»è¾‘çš„ç»„åˆå¤„ç†

### ğŸ§  è¯­è¨€æ¨¡å‹æŠ½è±¡
- **ç»Ÿä¸€æ¥å£**ï¼šå…¼å®¹å¤šç§å¤§è¯­è¨€æ¨¡å‹
- **æµå¼å¤„ç†**ï¼šæ”¯æŒå®æ—¶æµå¼å“åº”
- **å¼‚æ­¥è°ƒç”¨**ï¼šé«˜æ€§èƒ½å¼‚æ­¥å¤„ç†èƒ½åŠ›
- **ä¸Šä¸‹æ–‡ç®¡ç†**ï¼šæ™ºèƒ½ä¸Šä¸‹æ–‡é•¿åº¦ç®¡ç†

### ğŸ›  å·¥å…·ç³»ç»Ÿ
- **å·¥å…·æŠ½è±¡**ï¼šç»Ÿä¸€çš„å·¥å…·æ¥å£å®šä¹‰
- **ç»“æ„åŒ–å·¥å…·**ï¼šæ”¯æŒå¤æ‚å‚æ•°å’Œè¿”å›å€¼
- **å·¥å…·æ³¨å†Œ**ï¼šåŠ¨æ€å·¥å…·å‘ç°å’Œæ³¨å†Œ
- **å·¥å…·æ‰§è¡Œå™¨**ï¼šå®‰å…¨çš„å·¥å…·æ‰§è¡Œç¯å¢ƒ

### ğŸ’¾ è®°å¿†ä¸å­˜å‚¨
- **å¯¹è¯è®°å¿†**ï¼šå¤šç§å¯¹è¯å†å²ç®¡ç†ç­–ç•¥
- **å‘é‡å­˜å‚¨**ï¼šé«˜æ•ˆçš„è¯­ä¹‰æœç´¢å’Œæ£€ç´¢
- **æ–‡æ¡£å¤„ç†**ï¼šæ–‡æ¡£åŠ è½½ã€åˆ†å‰²å’Œç´¢å¼•
- **åµŒå…¥æ¨¡å‹**ï¼šç»Ÿä¸€çš„æ–‡æœ¬å‘é‡åŒ–æ¥å£

### ğŸ”„ Runnable æ¡†æ¶
- **å“åº”å¼ç¼–ç¨‹**ï¼šåŸºäº RxJava3 çš„å“åº”å¼å¤„ç†
- **ç®¡é“æ“ä½œ**ï¼šçµæ´»çš„æ•°æ®å¤„ç†ç®¡é“
- **å¹¶è¡Œå¤„ç†**ï¼šé«˜æ•ˆçš„å¹¶è¡Œè®¡ç®—æ”¯æŒ
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé‡è¯•æœºåˆ¶

## é¡¹ç›®ç»“æ„

```
ali-langengine-core/
â”œâ”€â”€ src/main/java/com/alibaba/langengine/core/
â”‚   â”œâ”€â”€ adapter/           # é€‚é…å™¨æ¨¡å—
â”‚   â”œâ”€â”€ agent/            # Agent æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ autogpt/      # AutoGPT Agent å®ç°
â”‚   â”‚   â”œâ”€â”€ conversational/ # å¯¹è¯ Agent
â”‚   â”‚   â”œâ”€â”€ mrkl/         # MRKL Agent
â”‚   â”‚   â”œâ”€â”€ planexecute/  # è§„åˆ’æ‰§è¡Œ Agent
â”‚   â”‚   â”œâ”€â”€ reactdoc/     # ReAct Document Agent
â”‚   â”‚   â”œâ”€â”€ selfask/      # SelfAsk Agent
â”‚   â”‚   â”œâ”€â”€ semantickernel/ # Semantic Kernel Agent
â”‚   â”‚   â””â”€â”€ structured/   # ç»“æ„åŒ– Agent
â”‚   â”œâ”€â”€ caches/           # ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ callback/         # å›è°ƒç³»ç»Ÿ
â”‚   â”œâ”€â”€ chain/            # é“¾å¼å¤„ç†
â”‚   â”œâ”€â”€ chatmodel/        # èŠå¤©æ¨¡å‹
â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ docloader/        # æ–‡æ¡£åŠ è½½å™¨
â”‚   â”œâ”€â”€ doctransformer/   # æ–‡æ¡£è½¬æ¢å™¨
â”‚   â”œâ”€â”€ embeddings/       # åµŒå…¥æ¨¡å‹
â”‚   â”œâ”€â”€ indexes/          # ç´¢å¼•å’Œæ£€ç´¢
â”‚   â”œâ”€â”€ languagemodel/    # è¯­è¨€æ¨¡å‹æŠ½è±¡
â”‚   â”œâ”€â”€ memory/           # å†…å­˜ç®¡ç†
â”‚   â”œâ”€â”€ messages/         # æ¶ˆæ¯ç±»å‹
â”‚   â”œâ”€â”€ model/            # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ outputparser/     # è¾“å‡ºè§£æå™¨
â”‚   â”œâ”€â”€ prompt/           # æç¤ºæ¨¡æ¿
â”‚   â”œâ”€â”€ runnables/        # Runnable æ¡†æ¶
â”‚   â”œâ”€â”€ storage/          # å­˜å‚¨æŠ½è±¡
â”‚   â”œâ”€â”€ textsplitter/     # æ–‡æœ¬åˆ†å‰²å™¨
â”‚   â”œâ”€â”€ tokenizers/       # åˆ†è¯å™¨
â”‚   â”œâ”€â”€ tool/             # å·¥å…·ç³»ç»Ÿ
â”‚   â”œâ”€â”€ util/             # å·¥å…·ç±»
â”‚   â””â”€â”€ vectorstore/      # å‘é‡å­˜å‚¨
â””â”€â”€ src/test/             # æµ‹è¯•ä»£ç 
```

## æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. Agent ç³»ç»Ÿ

#### BaseLanguageModel
- æ‰€æœ‰è¯­è¨€æ¨¡å‹çš„æŠ½è±¡åŸºç±»
- æä¾›ç»Ÿä¸€çš„æ–‡æœ¬ç”Ÿæˆã€é¢„æµ‹å’Œæµå¼å¤„ç†æ¥å£
- æ”¯æŒå‡½æ•°è°ƒç”¨å’Œç»“æ„åŒ–è¾“å‡º

```java
public abstract class BaseLanguageModel<T> extends Runnable<RunnableInput, RunnableOutput> {
    // ç»Ÿä¸€çš„é¢„æµ‹æ¥å£
    public abstract String predict(String text, List<String> stops, 
                                 ExecutionContext executionContext, 
                                 Consumer<T> consumer, 
                                 Map<String, Object> extraAttributes);
    
    // æ‰¹é‡ç”Ÿæˆ
    public abstract LLMResult generatePrompt(List<PromptValue> prompts, 
                                           List<FunctionDefinition> functions, 
                                           List<String> stops, 
                                           ExecutionContext executionContext, 
                                           Consumer<T> consumer, 
                                           Map<String, Object> extraAttributes);
}
```

#### Agent
- Agent çš„æ ¸å¿ƒæŠ½è±¡ç±»
- ç®¡ç†æ€è€ƒè¿‡ç¨‹å’Œå·¥å…·è°ƒç”¨å†³ç­–
- æ„å»º Agent çš„æ¨ç†æš‚å­˜å™¨

```java
public abstract class Agent extends BaseSingleActionAgent {
    // æ„å»ºæ€è€ƒæš‚å­˜å™¨
    public String constructScratchpad(List<AgentAction> intermediateSteps);
    
    // è§„åˆ’ä¸‹ä¸€æ­¥åŠ¨ä½œ
    public Object plan(List<AgentAction> intermediateSteps, 
                      Map<String, Object> inputs, 
                      Consumer<String> consumer, 
                      ExecutionContext executionContext, 
                      Map<String, Object> extraAttributes);
}
```

#### AgentExecutor
- Agent æ‰§è¡Œå™¨ï¼Œç®¡ç†å®Œæ•´çš„æ‰§è¡Œæµç¨‹
- æ§åˆ¶æœ€å¤§è¿­ä»£æ¬¡æ•°å’Œæ‰§è¡Œæ—¶é—´
- å¤„ç†å·¥å…·è°ƒç”¨å’Œç»“æœåé¦ˆ

```java
public class AgentExecutor extends Chain {
    private BaseSingleActionAgent agent;
    private List<BaseTool> tools;
    private Integer maxIterations = 10;
    private String earlyStoppingMethod = "generate";
    
    // æ‰§è¡Œæ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿå¾ªç¯
    public Object takeNextStep(Map<String, BaseTool> nameToToolMap,
                              Map<String, Object> inputs,
                              List<AgentAction> intermediateSteps,
                              Consumer<String> consumer,
                              ExecutionContext executionContext,
                              Map<String, Object> extraAttributes);
}
```

### 2. é“¾å¼å¤„ç†

#### Chain
- æ‰€æœ‰é“¾å¼å¤„ç†ç»„ä»¶çš„åŸºç±»
- æä¾›ç»Ÿä¸€çš„è°ƒç”¨ã€è¿è¡Œå’Œå›è°ƒæ¥å£
- æ”¯æŒå†…å­˜ç®¡ç†å’Œæ‰§è¡Œä¸Šä¸‹æ–‡

```java
public abstract class Chain extends Runnable<RunnableInput, RunnableOutput> {
    private BaseLanguageModel llm;
    private BaseMemory memory;
    private BaseCallbackManager callbackManager;
    
    // æ ¸å¿ƒè°ƒç”¨æ–¹æ³•
    public abstract Map<String, Object> call(Map<String, Object> inputs, 
                                           ExecutionContext executionContext,
                                           Consumer<String> consumer, 
                                           Map<String, Object> extraAttributes);
}
```

#### LLMChain
- ç»“åˆæç¤ºæ¨¡æ¿å’Œè¯­è¨€æ¨¡å‹çš„åŸºç¡€é“¾
- æ”¯æŒæ‰¹é‡å¤„ç†å’Œå¼‚æ­¥è°ƒç”¨
- æä¾›é¢„æµ‹å’Œæ ¼å¼åŒ–è¾“å‡º

```java
public class LLMChain extends Chain {
    private BasePromptTemplate prompt;
    private String outputKey = "text";
    
    // ç”Ÿæˆ LLM ç»“æœ
    public LLMResult generate(List<Map<String, Object>> inputs, 
                            ExecutionContext executionContext, 
                            Consumer<String> consumer, 
                            Map<String, Object> extraAttributes);
}
```

### 3. å·¥å…·ç³»ç»Ÿ

#### BaseTool
- æ‰€æœ‰å·¥å…·çš„æŠ½è±¡åŸºç±»
- å®šä¹‰å·¥å…·çš„åç§°ã€æè¿°å’Œæ‰§è¡Œæ¥å£
- æ”¯æŒå‡½æ•°å®šä¹‰å’Œå‚æ•°éªŒè¯

```java
public abstract class BaseTool extends Runnable<Object, RunnableOutput> {
    private String name;
    private String description;
    private String parameters;
    private Map<String, Object> args;
    private boolean returnDirect;
    
    // å·¥å…·æ‰§è¡Œæ–¹æ³•
    public abstract ToolExecuteResult run(String toolInput, 
                                        ExecutionContext executionContext);
}
```

### 4. å†…å­˜ç®¡ç†

#### BaseMemory
- å†…å­˜ç³»ç»Ÿçš„æŠ½è±¡åŸºç±»
- ç®¡ç†å¯¹è¯å†å²å’Œä¸Šä¸‹æ–‡ä¿¡æ¯
- æ”¯æŒä¸åŒè§’è‰²çš„æ¶ˆæ¯å‰ç¼€è®¾ç½®

```java
public abstract class BaseMemory {
    private String humanPrefix = "Human";
    private String aiPrefix = "AI";
    private String memoryKey = "history";
    
    // åŠ è½½å†…å­˜å˜é‡
    public abstract Map<String, Object> loadMemoryVariables(String sessionId, 
                                                          Map<String, Object> inputs);
    
    // ä¿å­˜ä¸Šä¸‹æ–‡
    public abstract void saveContext(String sessionId, 
                                   Map<String, Object> inputs, 
                                   Map<String, Object> outputs);
}
```

### 5. å‘é‡å­˜å‚¨

#### VectorStore
- å‘é‡æ•°æ®åº“çš„æŠ½è±¡åŸºç±»
- æä¾›æ–‡æ¡£å­˜å‚¨å’Œç›¸ä¼¼æ€§æœç´¢
- æ”¯æŒæ£€ç´¢å™¨é›†æˆ

```java
public abstract class VectorStore {
    // æ·»åŠ æ–‡æ¡£
    public abstract void addDocuments(List<Document> documents);
    
    // ç›¸ä¼¼æ€§æœç´¢
    public abstract List<Document> similaritySearch(String query, 
                                                  int k, 
                                                  Double maxDistanceValue, 
                                                  Integer type);
    
    // è½¬æ¢ä¸ºæ£€ç´¢å™¨
    public BaseRetriever asRetriever();
}
```

### 6. Runnable æ¡†æ¶

#### Runnable
- å¯æ‰§è¡Œå·¥ä½œå•å…ƒçš„åŸºç±»
- æä¾›ç»Ÿä¸€çš„è°ƒç”¨ã€æ‰¹å¤„ç†ã€æµå¼å¤„ç†æ¥å£
- æ”¯æŒå¼‚æ­¥æ‰§è¡Œå’Œç»„åˆå˜æ¢

```java
public abstract class Runnable<Input, Output> implements RunnableInterface<Input, Output> {
    // åŸºç¡€è°ƒç”¨
    public abstract Output invoke(Input input, RunnableConfig config);
    
    // æµå¼å¤„ç†
    public abstract Output stream(Input input, 
                                RunnableConfig config, 
                                Consumer<Object> chunkConsumer);
    
    // æ‰¹å¤„ç†
    public List<Output> batch(List<Input> inputs, RunnableConfig config);
    
    // ç»„åˆæ“ä½œ
    public static RunnableSequence sequence(RunnableInterface... runnables);
    public static RunnableParallel parallel(RunnableInterface... runnables);
}
```

## æŠ€æœ¯æ ˆ

- **Java 8+**ï¼šæ ¸å¿ƒå¼€å‘è¯­è¨€
- **Maven**ï¼šé¡¹ç›®æ„å»ºå’Œä¾èµ–ç®¡ç†
- **RxJava3**ï¼šå“åº”å¼ç¼–ç¨‹æ”¯æŒ
- **Jackson**ï¼šJSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–
- **OkHttp3**ï¼šHTTP å®¢æˆ·ç«¯
- **Retrofit2**ï¼šREST API å®¢æˆ·ç«¯
- **Guava**ï¼šå·¥å…·åº“å’Œç¼“å­˜
- **Commons Lang3**ï¼šApache å·¥å…·åº“
- **Dom4j**ï¼šXML å¤„ç†
- **JSoup**ï¼šHTML è§£æ

## ä¸»è¦ä¾èµ–

```xml
<dependencies>
    <!-- Apache Commons -->
    <dependency>
        <groupId>org.apache.commons</groupId>
        <artifactId>commons-lang3</artifactId>
    </dependency>
    
    <!-- JSON å¤„ç† -->
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>fastjson</artifactId>
    </dependency>
    
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-databind</artifactId>
    </dependency>
    
    <!-- HTTP å®¢æˆ·ç«¯ -->
    <dependency>
        <groupId>com.squareup.okhttp3</groupId>
        <artifactId>okhttp</artifactId>
    </dependency>
    
    <dependency>
        <groupId>com.squareup.retrofit2</groupId>
        <artifactId>retrofit</artifactId>
    </dependency>
    
    <!-- å·¥å…·åº“ -->
    <dependency>
        <groupId>com.google.guava</groupId>
        <artifactId>guava</artifactId>
    </dependency>
    
    <!-- HTML/XML å¤„ç† -->
    <dependency>
        <groupId>org.jsoup</groupId>
        <artifactId>jsoup</artifactId>
    </dependency>
    
    <dependency>
        <groupId>org.dom4j</groupId>
        <artifactId>dom4j</artifactId>
    </dependency>
</dependencies>
```

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ LLM è°ƒç”¨

```java
// åˆ›å»ºè¯­è¨€æ¨¡å‹ï¼ˆéœ€è¦å…·ä½“å®ç°ï¼‰
BaseLanguageModel llm = new YourLLMImplementation();

// åˆ›å»º LLM é“¾
LLMChain chain = new LLMChain();
chain.setLlm(llm);

// åˆ›å»ºæç¤ºæ¨¡æ¿
PromptTemplate prompt = new PromptTemplate();
prompt.setTemplate("è¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š{question}");
prompt.setInputVariables(Arrays.asList("question"));
chain.setPrompt(prompt);

// æ‰§è¡Œè°ƒç”¨
Map<String, Object> inputs = new HashMap<>();
inputs.put("question", "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ");
Map<String, Object> result = chain.run(inputs);
System.out.println(result.get("text"));
```

### 2. åˆ›å»º Agent

```java
// å‡†å¤‡å·¥å…·
List<BaseTool> tools = Arrays.asList(
    new SearchTool(),
    new CalculatorTool()
);

// åˆ›å»º Agent
Agent agent = StructuredChatAgent.fromLlmAndTools(llm, tools);

// åˆ›å»º Agent æ‰§è¡Œå™¨
AgentExecutor executor = new AgentExecutor();
executor.setAgent(agent);
executor.setTools(tools);
executor.setMaxIterations(5);

// æ‰§è¡Œä»»åŠ¡
Map<String, Object> inputs = new HashMap<>();
inputs.put("input", "æœç´¢ä»Šå¤©çš„å¤©æ°”ï¼Œç„¶åè®¡ç®— 25 * 4");
Map<String, Object> result = executor.run(inputs);
System.out.println(result.get("output"));
```

### 3. ä½¿ç”¨å‘é‡å­˜å‚¨

```java
// åˆ›å»ºåµŒå…¥æ¨¡å‹ï¼ˆéœ€è¦å…·ä½“å®ç°ï¼‰
Embeddings embeddings = new YourEmbeddingsImplementation();

// åˆ›å»ºå‘é‡å­˜å‚¨ï¼ˆéœ€è¦å…·ä½“å®ç°ï¼‰
VectorStore vectorStore = new YourVectorStoreImplementation();
vectorStore.setEmbedding(embeddings);

// æ·»åŠ æ–‡æ¡£
List<String> texts = Arrays.asList(
    "äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯",
    "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„æ ¸å¿ƒæŠ€æœ¯",
    "æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªå­é›†"
);
vectorStore.addTexts(texts);

// æœç´¢ç›¸ä¼¼æ–‡æ¡£
List<Document> results = vectorStore.similaritySearch("ä»€ä¹ˆæ˜¯AIï¼Ÿ", 3);
for (Document doc : results) {
    System.out.println(doc.getPageContent());
}
```

### 4. æµå¼å¤„ç†

```java
// åˆ›å»ºæµå¼ Consumer
Consumer<String> streamConsumer = chunk -> {
    System.out.print(chunk);
};

// æµå¼è°ƒç”¨
ExecutionContext context = new ExecutionContext();
chain.run(inputs, context, streamConsumer, null);
```

## æ‰©å±•å¼€å‘

### 1. è‡ªå®šä¹‰ Agent

```java
public class CustomAgent extends Agent {
    
    @Override
    public String observationPrefix() {
        return "è§‚å¯Ÿ: ";
    }
    
    @Override
    public String llmPrefix() {
        return "æ€è€ƒ: ";
    }
    
    // å®ç°å…¶ä»–æŠ½è±¡æ–¹æ³•...
}
```

### 2. è‡ªå®šä¹‰å·¥å…·

```java
public class CustomTool extends BaseTool {
    
    public CustomTool() {
        setName("custom_tool");
        setDescription("è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å·¥å…·");
        setParameters("{\"type\":\"object\",\"properties\":{\"input\":{\"type\":\"string\"}}}");
    }
    
    @Override
    public ToolExecuteResult run(String toolInput, ExecutionContext executionContext) {
        // å®ç°å·¥å…·é€»è¾‘
        String result = processInput(toolInput);
        return new ToolExecuteResult(result);
    }
    
    private String processInput(String input) {
        // è‡ªå®šä¹‰å¤„ç†é€»è¾‘
        return "å¤„ç†ç»“æœ: " + input;
    }
}
```

### 3. è‡ªå®šä¹‰é“¾

```java
public class CustomChain extends Chain {
    
    @Override
    public Map<String, Object> call(Map<String, Object> inputs,
                                  ExecutionContext executionContext,
                                  Consumer<String> consumer,
                                  Map<String, Object> extraAttributes) {
        // å®ç°è‡ªå®šä¹‰é“¾é€»è¾‘
        Map<String, Object> outputs = new HashMap<>();
        // å¤„ç†é€»è¾‘...
        return outputs;
    }
    
    @Override
    public List<String> getInputKeys() {
        return Arrays.asList("input");
    }
    
    @Override
    public List<String> getOutputKeys() {
        return Arrays.asList("output");
    }
}
```

## é…ç½®è¯´æ˜

### å…¨å±€é…ç½®

```java
// è®¾ç½®å…¨å±€å›è°ƒç®¡ç†å™¨
LangEngineConfiguration.CALLBACK_MANAGER = new CustomCallbackManager();

// è®¾ç½®ç¼“å­˜
LangEngineConfiguration.CurrentCache = new InMemoryCache();

// è®¾ç½®æ¨èæ•°é‡
LangEngineConfiguration.RETRIEVAL_QA_RECOMMEND_COUNT = "5";
```

### å›è°ƒå¤„ç†

```java
// åˆ›å»ºå›è°ƒå¤„ç†å™¨
BaseCallbackHandler handler = new LocalLogCallbackHandler();

// åˆ›å»ºå›è°ƒç®¡ç†å™¨
CallbackManager callbackManager = new CallbackManager();
callbackManager.addHandler(handler);

// è®¾ç½®ç»™ç»„ä»¶
chain.setCallbackManager(callbackManager);
```

## æ€§èƒ½ä¼˜åŒ–

### 1. å¼‚æ­¥å¤„ç†

```java
// å¼‚æ­¥è°ƒç”¨é“¾
CompletableFuture<Map<String, Object>> future = chain.runAsync(inputs);
Map<String, Object> result = future.get();

// å¼‚æ­¥ LLM è°ƒç”¨
CompletableFuture<String> prediction = llm.predictAsync("è¾“å…¥æ–‡æœ¬");
String result = prediction.get();
```

### 2. æ‰¹å¤„ç†

```java
// æ‰¹é‡å¤„ç†å¤šä¸ªè¾“å…¥
List<Map<String, Object>> batchInputs = Arrays.asList(inputs1, inputs2, inputs3);
List<Map<String, Object>> results = chain.batch(batchInputs);
```

### 3. ç¼“å­˜ç­–ç•¥

```java
// ä½¿ç”¨ç¼“å­˜çš„åµŒå…¥æ¨¡å‹
CacheBackedEmbeddings cachedEmbeddings = new CacheBackedEmbeddings();
cachedEmbeddings.setUnderlyingEmbeddings(baseEmbeddings);
cachedEmbeddings.setDocumentEmbeddingCache(cache);
```

## æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

```java
try {
    Map<String, Object> result = chain.run(inputs);
    // å¤„ç†æˆåŠŸç»“æœ
} catch (Exception e) {
    // è®°å½•é”™è¯¯
    log.error("Chain execution failed", e);
    // å¤„ç†é”™è¯¯æƒ…å†µ
}
```

### 2. èµ„æºç®¡ç†

```java
// ä½¿ç”¨ try-with-resources ç®¡ç†èµ„æº
try (ExecutionContext context = new ExecutionContext()) {
    context.setChain(chain);
    Map<String, Object> result = chain.run(inputs, context, null, null);
}
```

### 3. é…ç½®ç®¡ç†

```java
// ä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†å‚æ•°
Properties config = WorkPropertiesUtils.loadProperties("config.properties");
String maxTokens = config.getProperty("llm.max_tokens", "2048");
```

## æµ‹è¯•

é¡¹ç›®åŒ…å«å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
mvn test -Dtest=AgentExecutorTest

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
mvn surefire-report:report
```

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add some amazing feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/amazing-feature`
5. æäº¤ Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache License 2.0 è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](../LICENSE) æ–‡ä»¶ã€‚

## ç›¸å…³é“¾æ¥

- [Agentic-ADK ä¸»é¡¹ç›®](https://github.com/AIDC-AI/Agentic-ADK)
- [Ali-LangEngine åŸºç¡€è®¾æ–½æ¨¡å—](../ali-langengine-infrastructure/README.md)
- [Ali-LangEngine ç¤¾åŒºæ¨¡å—](../ali-langengine-community/README.md)
- [é¡¹ç›®æ–‡æ¡£](https://github.com/AIDC-AI/Agentic-ADK/wiki)

---

è¯¥æ¨¡å—ä½œä¸º Agentic-ADK çš„æ ¸å¿ƒå¼•æ“ï¼Œä¸ºæ„å»ºæ™ºèƒ½ Agent åº”ç”¨æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚é€šè¿‡æ¨¡å—åŒ–çš„è®¾è®¡å’Œä¸°å¯Œçš„æ‰©å±•ç‚¹ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾æ„å»ºå„ç§ç±»å‹çš„ AI åº”ç”¨ã€‚